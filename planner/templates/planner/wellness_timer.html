{% extends "planner/base.html" %}

{% block content %}
<style>
  .wellness-wrap{ max-width:980px; margin:20px auto; padding:18px; }
  .timer-card{ display:flex; gap:20px; background:#fff; padding:18px; border-radius:12px; box-shadow:0 8px 30px rgba(2,6,23,0.06); align-items:center; }
  .left { flex:0 0 320px; text-align:center; }
  .time-display { font-size:56px; font-weight:800; color:#0f172a; letter-spacing:1px; }
  .controls { margin-top:14px; display:flex; gap:8px; justify-content:center; flex-wrap:wrap; }
  .btn { padding:10px 14px; border-radius:8px; border:none; cursor:pointer; font-weight:700; }
  .btn-start { background:#06b6d4; color:white; }
  .btn-pause { background:#f59e0b; color:white; }
  .btn-reset { background:#ef4444; color:white; }
  .preset { padding:8px 10px; border-radius:999px; border:1px solid #e6eef6; cursor:pointer; background:#fbfdff; }
  .right { flex:1; }
  .carousel { position:relative; height:300px; border-radius:12px; overflow:hidden; background:#f8fafc; display:flex; align-items:center; justify-content:center; }
  .carousel img { max-width:100%; max-height:100%; object-fit:cover; width:100%; height:100%; display:block; transition:opacity .45s ease; }
  .quote { position:absolute; left:12px; bottom:12px; right:12px; color:white; font-weight:700; text-shadow:0 4px 20px rgba(0,0,0,0.45); padding:10px; border-radius:8px; background: linear-gradient(90deg, rgba(0,0,0,0.35), rgba(0,0,0,0.15)); }
  .small { font-size:13px; color:#475569; margin-top:8px; }
  .file-uploader { margin-top:10px; }
  .thumbs { margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; }
  .thumbs img { width:80px; height:56px; object-fit:cover; border-radius:8px; border:2px solid #fff; box-shadow:0 6px 18px rgba(2,6,23,0.06); cursor:pointer; }
  @media (max-width:800px){ .timer-card{flex-direction:column; align-items:stretch;} .left{flex:auto} }
</style>

<div class="wellness-wrap">
  <h2>Wellness — Focus Timer</h2>
  <p class="small">Pick a timer, add your own motivational images (preview-only), start a focused session and relax your mind between bursts.</p>

  <div class="timer-card">
    <div class="left">
      <div style="font-size:14px; color:#64748b; margin-bottom:6px;">Select duration</div>

      <div style="display:flex; gap:8px; justify-content:center; flex-wrap:wrap;">
        <button class="preset" data-seconds="30">30s</button>
        <button class="preset" data-seconds="60">1m</button>
        <button class="preset" data-seconds="300">5m</button>
        <button class="preset" data-seconds="900">15m</button>
        <button class="preset" id="customBtn">Custom</button>
      </div>

      <div style="margin-top:12px;">
        <input id="customInput" type="number" placeholder="Enter seconds" style="padding:8px; width:160px; border-radius:8px; border:1px solid #e6eef6;" />
      </div>

      <div class="time-display" id="timeDisplay">00:30</div>

      <div class="controls">
        <button class="btn btn-start" id="startBtn">Start</button>
        <button class="btn btn-pause" id="pauseBtn" disabled>Pause</button>
        <button class="btn btn-reset" id="resetBtn">Reset</button>
      </div>

      <div class="small">Auto-break suggestion: after each session, take 30–60 seconds of deep breathing.</div>

      <div class="file-uploader">
        <label class="small" style="display:block; margin-top:8px;">Preview your motivational images (select multiple):</label>
        <input id="imageInput" type="file" accept="image/*" multiple>
        <div class="thumbs" id="thumbs"></div>
      </div>
    </div>

    <div class="right">
      <div class="carousel" id="carousel">
        <!-- carousel images will be injected here -->
      </div>

      <div style="display:flex; gap:10px; margin-top:10px; align-items:center;">
        <div style="flex:1;">
          <div style="font-weight:700;">Mood Boosters</div>
          <div class="small">Quick tips: breathe deeply, smile, stretch shoulders, sip water.</div>
        </div>

        <div>
          <button class="btn" id="prevImg">◀</button>
          <button class="btn" id="nextImg">▶</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // Default motivational images (can be local static files or web urls)
  const defaultImages = [
    "https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1600&auto=format&fit=crop&ixlib=rb-4.0.3&s=fe0bf6c7fc6b7c9f0d5e9a1a1f2b3a6e",
    "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?q=80&w=1600&auto=format&fit=crop&ixlib=rb-4.0.3&s=2d7a7f72f5a0a1fe1b4a66a0d1b2e1b7",
    "https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?q=80&w=1600&auto=format&fit=crop&ixlib=rb-4.0.3&s=6fc1f5f1c6bfe7d5e9c3f6f0a3b5b8b8",
    "https://images.unsplash.com/photo-1524504388940-8e6f3e0a2b6b?q=80&w=1600&auto=format&fit=crop&ixlib=rb-4.0.3&s=2f7c7b9a6a5b4a3c2d1e0f9a8b7c6d5e"
  ];

  // quotes shown on each image
  const quotes = [
    "Breathe. Focus. You’ve got this.",
    "Small steps. Big results.",
    "Be kind to yourself — progress is progress.",
    "One session at a time. One breath at a time."
  ];

  // timer logic
  let totalSeconds = 30;
  let remaining = totalSeconds;
  let interval = null;
  let running = false;

  const timeDisplay = document.getElementById('timeDisplay');
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const resetBtn = document.getElementById('resetBtn');
  const presetButtons = document.querySelectorAll('.preset');
  const customInput = document.getElementById('customInput');

  function formatTime(sec){
    const m = Math.floor(sec/60);
    const s = sec%60;
    return String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
  }

  function setTime(sec){
    totalSeconds = Math.max(1, Math.floor(sec));
    remaining = totalSeconds;
    timeDisplay.textContent = formatTime(remaining);
  }

  // attach preset handlers
  presetButtons.forEach(btn=>{
    btn.addEventListener('click', ()=> {
      const s = parseInt(btn.dataset.seconds || 0, 10);
      if(s > 0) setTime(s);
      customInput.value = '';
    });
  });

  // custom input
  customInput.addEventListener('input', ()=>{
    const val = Number(customInput.value);
    if(!isNaN(val) && val > 0){
      setTime(val);
    }
  });

  startBtn.addEventListener('click', ()=>{
    if(running) return;
    running = true;
    startBtn.disabled = true;
    pauseBtn.disabled = false;
    interval = setInterval(()=>{
      if(remaining <= 0){
        clearInterval(interval);
        running = false;
        startBtn.disabled = false;
        pauseBtn.disabled = true;
        // finished: short animation / sound
        flashCarousel();
        return;
      }
      remaining -= 1;
      timeDisplay.textContent = formatTime(remaining);
    }, 1000);
  });

  pauseBtn.addEventListener('click', ()=>{
    if(!running) return;
    clearInterval(interval);
    running = false;
    startBtn.disabled = false;
    pauseBtn.disabled = true;
  });

  resetBtn.addEventListener('click', ()=>{
    clearInterval(interval);
    running = false;
    startBtn.disabled = false;
    pauseBtn.disabled = true;
    remaining = totalSeconds;
    timeDisplay.textContent = formatTime(remaining);
  });

  // small visual feedback when finished
  function flashCarousel(){
    const el = document.getElementById('carousel');
    el.style.transition = 'box-shadow .25s';
    el.style.boxShadow = '0 0 0 6px rgba(6,182,212,0.18)';
    setTimeout(()=> el.style.boxShadow = '', 700);
    // optional: speak gentle chime
    if(window.speechSynthesis){
      const msg = new SpeechSynthesisUtterance("Session complete. Well done.");
      window.speechSynthesis.speak(msg);
    }
  }

  // carousel logic
  const carousel = document.getElementById('carousel');
  let images = defaultImages.slice();
  let captions = quotes.slice();
  let currentIndex = 0;

  function renderCarousel(){
    carousel.innerHTML = '';
    const img = document.createElement('img');
    img.src = images[currentIndex];
    img.style.opacity = '0';
    img.onload = ()=> img.style.opacity = '1';
    carousel.appendChild(img);

    const quote = document.createElement('div');
    quote.className = 'quote';
    quote.innerText = captions[currentIndex] || '';
    carousel.appendChild(quote);
  }

  document.getElementById('prevImg').addEventListener('click', ()=> {
    currentIndex = (currentIndex - 1 + images.length) % images.length;
    renderCarousel();
  });
  document.getElementById('nextImg').addEventListener('click', ()=> {
    currentIndex = (currentIndex + 1) % images.length;
    renderCarousel();
  });

  // preview user selected files client-side (no upload)
  const imageInput = document.getElementById('imageInput');
  const thumbs = document.getElementById('thumbs');

  imageInput.addEventListener('change', (e)=>{
    const files = Array.from(e.target.files).filter(f=> f.type.startsWith('image/'));
    if(files.length === 0) return;
    thumbs.innerHTML = '';
    files.forEach((file, idx)=>{
      const url = URL.createObjectURL(file);
      const img = document.createElement('img');
      img.src = url;
      img.title = file.name;
      img.addEventListener('click', ()=> {
        // add clicked image to carousel and show it
        images.unshift(url);
        captions.unshift("Your Motivation");
        currentIndex = 0;
        renderCarousel();
      });
      thumbs.appendChild(img);
    });
    // automatically add first uploaded image to carousel
    if(files.length > 0){
      const firstURL = URL.createObjectURL(files[0]);
      images.unshift(firstURL);
      captions.unshift("Your Motivation");
      currentIndex = 0;
      renderCarousel();
    }
  });

  // init
  setTime(30);         // default 30s
  renderCarousel();

})();
</script>
{% endblock %}
